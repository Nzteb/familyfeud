{% extends "global/Page.html" %}
{% load staticfiles otree %}

{% block title %}
    Page title
{% endblock %}

{% block scripts %}
  <script>


    // Boilerplate that lets you access useful oTree template variables from Javascript.
    // from the docs:
    //<otree-constants>` is used by most of the other webcomponents, so this block is
    //required in any template using the otree-redwood components:
    var oTree = oTree || {};
    (function() {
      oTree.group = parseInt("{{ player.group.pk }}");
      oTree.group = isNaN(oTree.group) ? null : oTree.group;
      oTree.role = "{{ player.role }}";
      oTree.participantCode = "{{ player.participant.code }}";
      oTree.appName = "{{ subsession.app_name }}";
      oTree.idInGroup = "{{ player.id_in_group }}";
      oTree.csrfToken = "{{ csrf_token }}";
      {% if view.is_debug %}
      oTree.debug = true;
      {% else %}
      oTree.debug = false;
      {% endif %}
    })();




    //This function is called when the submitt button is clicked
    // this fills the field where the own submissions are listed
    // I also want that the channel is fired from here...
    function handleGuess() {
        //TODO initialize the variables out of the function?
        //grap the input of the input form as a variable
         var guessed = document.getElementById('guessField').value;
         var result = document.getElementById('result');
         var guessingChan = document.getElementById("guessingChannel");

        if (guessed.length < 1) {
            result.textContent = 'Please type anything';

        } else {
            result.textContent = guessed;
            guessingChan.send({word: guessed})
        }
    }

    // Call the handle Guess function whenever the submitt button is clicked (then the guess is displayed for the player and sended to the channel)
    var subButton = document.getElementById('subButton');
    subButton.addEventListener('click', handleGuess, false);

    // function that receives the other guesses and modifies the respective html tag to display it
    function other_guesses(event) {
        //receive the guess of another player, call it msg
        var setguess =  document.getElementById('otherguess');
        setguess.textContent = event.detail.payload
        setguess.textContent = 'At least, the function was called'

    }
    document.getElementById('groupGuessChannel').addEventListener('event', other_guesses);

  </script>

  <link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-period/redwood-period.html">
  <link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-channel/redwood-channel.html" />
  <link
    rel="import"
    href="/static/bower_components/polymer/polymer.html" />

  {% endblock %}

  {% block content %}

      <redwood-period></redwood-period>

      <redwood-channel
    		id="guessingChannel"
    		channel="guessingChannel">
	    </redwood-channel>


      <redwood-channel
        id="groupGuessChannel"
    		channel="group_guesses">
	    </redwood-channel>


    	<redwood-channel
        id="correctGuessChannel"
    		channel="correct_guess">
	    </redwood-channel>


      <!-- Template of the page -->


      <!-- Input form -->
        <div class='wrapper'>
        <form id='nameForm'>
            <div class='form-uname'>
            <lable id='nameLable' for='guessField'>Guess a word:</lable>
            <input id='guessField' type='text' maxlength='25'></input>
        </div>

        <br><br>

        <!-- Submitt input button -->
        <div class='form-sub'>
        <button id='subButton' type='button'>Submitt your guess</button>
        </div>
        </form>

        <br> <br>

         <!-- Display the players last guess -->
        <div>
            <p id='result'></p></div>
        </div>

      <br><br>

       <!-- Display guesses of the other players -->
       <div>
       Other guess: <p id='otherguess'></p>
       </div>


{% endblock %}


